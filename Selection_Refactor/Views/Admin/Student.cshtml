@{
    ViewBag.Title = "Student";
    ViewBag.CurrentTab = "student";
    ViewBag.Stage = 2;
    ViewBag.BoxTitle = "学生信息";
    ViewBag.Role = "Admin";
}
@section css{
    <link href="~/Content/css/AdminLTE.min.css" rel="stylesheet" />
    <link href="~/Content/plugins/datatables.net-bs/css/dataTables.bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/plugins/bootstrap-3.3.7/css/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/plugins/fileinput/css/fileinput.min.css" rel="stylesheet" />
}

<div id="page-wrapper">
    <div style="padding:0 0 5px 15px" class="form-inline">
        <button id="uploadStudents" class="btn btn-primary" style="margin-right:20px">上传学生</button>
        <button id="addStudents" class="btn btn-success" style="margin-right:20px">新增学生</button>
        <select id="filter-select" class="form-control">
            <option value="0">全部学生</option>
            <option value="1">没有提交信息学生</option>
            <option value="2">没有提交志愿学生</option>
            <option value="3">没有确定导师学生</option>
        </select>
    </div>
    <div class="box-body">
        <div id="professor-table" class="dataTables_wrapper form-inline dt-bootstrap">
            <div class="row">
                <div class="col-sm-12">
                    <table id="example1" class="table table-bordered table-striped dataTable" role="grid" aria-describedby="example1_info">
                        <thead>
                            <tr role="row">
                                <th class="sorting_asc" tabindex="0" aria-controls="example1" rowspan="1" colspan="1" aria-sort="ascending" data-field="OrderNumber" style="width: 55px;">序号</th>
                                <th class="sorting" tabindex="0" aria-controls="example1" rowspan="1" colspan="1" data-field="StuNumber" style="width: 65px;">学号</th>
                                <th class="sorting" tabindex="0" aria-controls="example1" rowspan="1" colspan="1" data-field="StuName" style="width: 60px;">姓名</th>
                                <th class="sorting" tabindex="0" aria-controls="example1" rowspan="1" colspan="1" data-field="Major" style="width: 70px;">专业方向</th>
                                <th class="sorting" tabindex="0" aria-controls="example1" rowspan="1" colspan="1" data-field="InfoCommited" style="width: 70px;">信息是否提交</th>
                                <th class="sorting" tabindex="0" aria-controls="example1" rowspan="1" colspan="1" data-field="TwoWillCommited" style="width: 70px;">是否两个志愿提交</th>
                                <th class="sorting" tabindex="0" aria-controls="example1" rowspan="1" colspan="1" data-field="FinalTutor" style="width: 70px;">最终确定导师</th>
                                <th class="sorting" tabindex="0" aria-controls="example1" rowspan="1" colspan="1" style="width: 120px;" data-formatter="operateFormatter" data-align='center' data-events='operateEvents'>操作</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>

</div>
<div style="clear:both">

    <!-- /. ROW  -->
</div>
<!-- /. PAGE INNER  -->
<!-- /. PAGE WRAPPER  -->
<!--以下是批量创建学生模态框-->
<div class="modal" id="batchAdd-students-modal" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4>请上传xlsx或xls文件</h4>
            </div>
            <div class="modal-body">
                <a href="~/ExcelFiles/template/教师批量录入.xlsx" class="form-control" style="margin-bottom:10px">下载导入模板</a>
                <input id="input-file" type="file" data-preview-file-type="text" name="file">
            </div>
        </div>
    </div>
</div>
<!--以上是批量创建学生模态框-->
<!--以下是直接新增学生模态框-->
<div class="modal" id="directAdd-students-modal" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content" style="height:480px">
            <div class="modal-header" style="padding-left:25px">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4>新增学生</h4>
            </div>
            <div class="modal-body">
                <form style="height:80%">
                    <div class="row" style="width:45%;display:inline;vertical-align:baseline;padding-left:50px;">
                        <div class="column" style="float:left;padding-left:20px">
                            <label>姓名</label>
                            <input id="name-input" type="text" class="form-control" placeholder="" style="width:200px;">
                        </div>
                        <div class="column" style="float:left;padding-left:50px">
                            <label>学号</label>
                            <input id="stunumber-input" type="text" class="form-control" placeholder="" style="width:200px;">
                        </div>
                    </div>
                    <div class="row" style="width:45%;display:inline;vertical-align:baseline;padding-left:50px;">
                        <div class="column" style="float:left;padding-left:20px">
                            <label>年龄</label>
                            <input id="age-input" type="text" class="form-control" placeholder="" style="width:200px;">
                        </div>
                        <div class="column" style="float:left;padding-left:50px">
                            <label>专业</label>
                            <input id="major-input" type="text" class="form-control" placeholder="" style="width:200px;">
                        </div>
                    </div>
                    <div class="row" style="width:45%;display:inline;vertical-align:baseline;padding-left:50px;">
                        <div class="column" style="float:left;padding-left:20px">
                            <label>电话</label>
                            <input id="telephone-input" type="text" class="form-control" placeholder="" style="width:200px;">
                        </div>
                        <div class="column" style="float:left;padding-left:50px">
                            <label>在职</label>
                            <input id="isworking-input" type="text" class="form-control" placeholder="" style="width:200px;">
                        </div>
                    </div>
                    <div class="row" style="width:45%;display:inline;vertical-align:baseline;padding-left:50px;">
                        <div class="column" style="float:left;padding-left:20px">
                            <label>邮箱</label>
                            <input id="email-input" type="text" class="form-control" placeholder="" style="width:200px;">
                        </div>
                    </div>
                </form>
                <div style="float:right;padding-right:25px">
                    <button id="addStudent-submit-button" type="submit" class="btn btn-primary">确认提交</button>
                </div>

            </div>
        </div>
    </div>
</div>
<!--以上是直接新增学生模态框-->
<!--以下是修改密码模态框-->
<div class="modal" id="reset-password-modal" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content" style="height:280px">
            <div class="modal-header" style="padding-left:25px">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4>修改密码</h4>
            </div>
            <div class="modal-body">
                <form style="height:80%">
                    <div class="row" style="width:45%;display:inline;vertical-align:baseline;padding-left:50px;">
                        <div class="column" style="float:left;padding-left:20px">
                            <label>新密码</label>
                            <input id="password-input" type="text" class="form-control" placeholder="" style="width:200px;">
                        </div>
                    </div>
                </form>
                <div style="float:right;padding-right:25px">
                    <button id="password-submit" type="submit" class="btn btn-primary">确认提交</button>
                </div>

            </div>
        </div>
    </div>
</div>
<!--以上是修改密码模态框-->
<!-- /. WRAPPER  -->
<!-- JS Scripts-->
<!-- jQuery Js -->
<!-- Bootstrap Js -->
<script src="~/Content/plugins/bootstrap-3.3.7/js/bootstrap.min.js"></script>
<!-- DataTables -->
<script src="~/Content/plugins/datatables.net/js/jquery.dataTables.min.js"></script>
<script src="~/Content/plugins/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
<script src="~/Content/plugins/fileinput/js/fileinput.min.js"></script>
<script src="~/Content/plugins/fileinput/js/zh.js"></script>
<script src="~/Content/js/gy-alert.js"></script>
<script>
    //下拉框筛选学生
    $.fn.dataTable.ext.search.push(
        function (settings, data, dataIndex) {
            var type = $('#filter-select').val();
            switch (type) {
                case "0": return true;
                case "1":
                    if (data[4] == "否")
                        return true;
                    break;
                case "2":
                    if (data[5] == "否")
                        return true;
                    break;
                case "3":
                    if (data[6] != "")
                        return true;
                    break;
                default: return false;
            }
            return false;
        }
    );

    $("#filter-select").change(function () {
        $('#example1').DataTable().draw()
    });

    function checkstudent() {
        alert("check");
    }
    function deletestudent() {
        $.gyAlert({ contentText: "确认删除该学生?", cancelButtonText: "取消" });
    }
    function resetpassword() {
        $("#reset-password-modal").modal('show')
    }
    
    var userType = 0;
    $(document).ready(function () {
        initTable();
        $("#uploadStudents").click(function () {
            $("#batchAdd-students-modal").modal('show');
        });
        $("#addStudents").click(function () {
            $("#directAdd-students-modal").modal('show');
        });
        $("#password-submit").click(function () {
            var data = {
                'password': $("#password-input").val()
            }
            alert("password:" + data.password);
            $("#reset-password-modal").modal('hide');
        });
        $("#addStudent-submit-button").click(function () {
            var data = {
                'name': $("#name-input").val(),
                'stunumber': $("#stunumber-input").val(),
                'age': $("#age-input").val(),
                'major': $("#major-input").val(),
                'telephone': $("#telephone-input").val(),
                'isworking': $("#isworking-input").val(),
                'email': $("#email-input").val(),
            }
            alert("name:" + data.name + " stunumber:" + data.stunumber + " age:" + data.age + " major:" + data.major + " telephone:" + data.telephone + " isworking:" + data.isworking + " email:" + data.email);
            $("#directAdd-professor-modal").modal('hide');
            $.post("/Gao_Home/changePassword", data, function (rel) {

                $("#directAdd-professor-modal").modal('hide');
            })
        });
    });

    //    $("#change_password_submit_button").click(function () {
    //        var data = {
    //            'password': $("#password_input").val(),
    //        }

    //        $.post("/Gao_Home/changePassword", data, function (rel) {
    //            alert(rel);
    //            $("#change_password_modal").modal('hide');
    //        })
    //    })

    var initTable = function () {
        $('#example1').DataTable({
            ajax: {
                url: 'https://www.easy-mock.com/mock/5b1fe0f0f71e0743260935e1/example/getStuInfo',
                dataSrc: 'data'
            },
            "columns": [
                { data: "OrderNumber" },
                { data: "StuNumber" },
                { data: "StuName" },
                { data: "Major" },
                { data: "InfoCommited" },
                { data: "TwoWillCommited" },
                { data: "FinalTutor" },
                {
                    data: function (row, type, set, meta) {
                        return [
                            '<button type="button" class="btn btn-block btn-info" style="width:25%;display:inline;vertical-align:baseline;" onclick="checkstudent()">查看</button> ',
                            '<button type="button" class="btn btn-block btn-success" style="width:25%;display:inline;vertical-align:baseline;" onclick="deletestudent()">删除</button> ',
                            '<button type="button" class="btn btn-block btn-primary" style="width:40%;display:inline;vertical-align:baseline;background-color:#3c8dbc" onclick="resetpassword()">重置密码</button> '
                        ].join('');
                    }
                },
            ]
        });
    }
    //var initJaowu = function () {
    //    var s = document.cookie.split("=");
    //    userType = s[s.length - 1];
    //    if (userType == 1) {
    //        $("#timesetting").remove();
    //        $("#addProfessor").remove();
    //        $("#uploadStudents").remove();
    //        $("#jiaowuinfo").remove();
    //        $("#welcome").text("欢迎登陆 教务教师");
    //    } else {
    //        $("#welcome").text("欢迎登陆 管理员");

    //    }
    //};


    $("#input-file").fileinput({
        language: 'zh', //设置语言
        uploadUrl: '/Gao_Admin/batchCreateTeachers',
        allowedFileExtensions: ['xlsx', 'xls'],//接收的文件后缀
        previewFileIcon: "<i class='glyphicon glyphicon-king'></i>",
        /*    initialPreview: "<div class='file-preview-text'>" +
"<h2><i class='glyphicon glyphicon-file'></i></h2>" +
"~/Content/img/bb.xlsx" + "</div>",
*/
        previewTemplates: "<img  src=\"~/Content/img/aa.jpg\"/>",
    });
</script>